# 信息安全导论

# Information Security

安全是当今 IT 相关头条新闻的一个重要话题。经常出现的系统漏洞和安全补丁以及病毒和蠕虫是每个使用计算机的人都耳熟能详的名词。因为几乎每台计算机系统都连接到另外的计算机或者连接到 Internet，因此确保这些计算机的安全，对于减少入侵、 数据窃取或丢失、误用甚至对第三方的责任而言是至关重要的。确保安全即使对于没有连接到网络的独立的计算机也是很重要的。必须自可信赖的来源安装应用程序，比如 经过验证的并检查过病毒的光盘。对应用程序数据也必须同样小心。例如，对于可以执行强大的宏语言 或者引入非法数据的软件程序包（office 套件等等），其软件缺陷可能会被利用来执行任意的代码。因此， 应用程序数据在拷贝到计算机之前必须经过完整性检查。可以通过将数据放置在一个安全的地方来控制对 系统的访问（当然，不考虑来自已授权人员的攻击）。当系统连接到网络并向其他计算机提供服务（有意地或无意地）时，事情会变得更为棘手。在那种情况下， 数据可能不只是来自系统管理员，因为客户机程序要使用所提供的服务，而系统漏洞可能会让入侵者控制 计算机。这就是为什么安全是从开始计划直到拆除系统的整个系统生命周期中最基本的问题。从宏观层面上，安全可以被分为系统安全与数据安全两个层面。常，数据安全和系统安全可以分开来考虑。*数据安全*通常被认为是确保以下方面的所有努力：

* 机密性（Confidentiality ）。
* 完整性（Integrity ）。
* 可用性（Availability ）。

综合起来，这些被称作是存储在计算机上的数据的 “CIA”。对 `/etc/passwd` 等配置数据的保护可以归类为数据安全。 _系统安全_ 指的是计算机平台本身。美国 NationalInformation Systems Security Glossary（参阅 [参考资料](http://www.ibm.com/developerworks/cn/linux/l-seclnx1.html#resources) 以获得链接）对系统安全的定义如下：**系统安全**。对信息系统的保护，防止未授权的访问及对信息（不论是存储中的、正在处理的还是正在传输的）的修改，并防止对授权用户服务的拒绝或对未授权用户服务的允许，包括那些检测、记录和反击此类威胁的措施。重要的是要认识到系统安全强调的是一个反复的过程，这个过程包括应用安全补丁、经常审计、控制，同时最起码要有一个安全的系统配置。就此而言，不可能保证绝对的安全，也不可能提供百分之百安全的服务。目标更应该是在安全性、系统可用性和维护这个安全层级所需要的努力这三者之间找到一个折衷点。这个折衷取决于安全对于存储在计算机中的数据来说的重要性以及这些数据预期的使用情形（阅读 Bruce Schneier 的 *Secrets and Lies*，John Wiley & Sons ， 2000；参阅 [参考资料](http://www.ibm.com/developerworks/cn/linux/l-seclnx1.html#resources)以获得链接）。

## 数据安全

### 完整性

具备 完整性 的数据是指合法的而且没有经过偶然的或恶意的修改。当进行数据存储或交换时应该考虑其完整性。 目标接收到的数据必须是源数据的原样拷贝。这就是说，一方面，物理传输和存储媒介必须是可靠的，以使得数据可以 正确地传输而不发生位错误。另一方面，数据必须不能被未经授权的实体不加检测地访问而修改。完整性的范围是从用户 —— 最终的权威 —— 将数据委托给系统后开始的。因此用户错误不在完整性范围之内。

对网络连接而言，要尤其注意确保完整性，不管网络是否安全（例如，通过加密传输）。在传输过程中，可以访问 传输媒介的第三方可能会重新路由或者修改数据。涉及网络的物理环境和互联的计算机的完整性的方面并不特定于 Linux， 而是对所有计算机安装来说都是如此；因而这也超出了本文的范围。无论如何，除了其他方法之外，在物理层上 采取的保护数据的措施包括，限制对计算机的访问、保持对传输媒介（比如电缆和连接器）的保护，以及避免停电和 静电释放（阅读 “Building the Ideal Web Hosting Facility: A Physical Security Perspective”， 参阅 参考资料以获得链接）。

本系列文章将集中关注加密和签名等在操作系统和应用程序环境中采取的措施，以积极地确保完整性。本文还将关注 审计机制，以识别完整性的缺失并确定应对此负责的当事人。

### 机密性

当受保护的数据只能被授权的人或系统读取或者修改时，要保持其 机密性。这是一个与完整性截然不同的 概念：当数据在网络上传输时，它可能是被毫无修改地正确传输，因此确保了其完整性，但是如果被第三方中途截取的 话就再也不是机密的了。当未被授权的人可以访问数据传输并从中获取有价值的信息时，只有完整性是不够的。 数据的机密性引出了三个更深入的问题：

    谁希望访问数据？（认证）
    哪些数据可以被访问？（授权）
    如何保护数据不受未授权的访问？

Linux 有若干方法可以确保试图访问数据的实体是其所宣称的那一个。通过 Pluggable Authentication Modules（PAM ），您可以 实现一些认证策略，从存储在本地机器上一个集中目录（NIS 、 Kerberos、LDAP 等等）中简单的用户名 / 口令组合，到 硬件标识或生物特征扫描不等。文件访问的授权可以使用传统的（粗糙的）UNIX 文件权限来解决：用户、组或全体级别的读、写和 执行权限。较新的细粒度的（fine-grained ）方法 —— 访问控制列表（Access Control Lists ） —— 让您可以为具体的用户授予 或拒绝具体的权限。

标准 Linux 安全概念是在软件中实现的，依赖于内核不接受没有被授权的用户对资源的使用。不过， 内核缺陷（特权提升 / 自动调整、未经检查的参数，等等）可能会使用户可以访问先前不能访问的内存 区域、磁盘空间、网络或者其他资源。通过安装击键记录器（keyloggers ）、取走硬盘驱动器并在其他 机器中读取、嗅探网络传输等等，对硬件物理上的访问可以让用户绕过软件检查。这样，必须采取 更进一步的努力来保护机密的数据，比如文件系统、单个文件、网络传输的加密，和 / 或应用程序级别 的加密。此外，物理上的措施也需要考虑，比如安全区域、数据的安全删除，以及机密信息的 会计程序，不过本文并不涉及这些。

### 可用性

即使完整性和机密性都得到了保证，如果数据不能被访问，那么它是没有用处的，即不可用的。 _可用性_ 措施确保数据永远不会丢失，而且当被请求时，可以以预定义的性能级别被访问。可用性可能会受到不同方式的威胁：

* 破坏性攻击 —— 称为拒绝服务（Denial-of-Service ， DoS）攻击 —— 这类攻击的目标是可用性。它们通过消耗所有可用的网络、CPU 、存储或操作系统资源（比如文件句柄），使得一台计算机或一个服务不可用或不能用。
* 目标是数据本身的攻击，试图删除或覆盖数据。
* 数据的意外破坏。在大部分情况下，不可能避免对数据的意外破坏，因为拥有适当权限的用户被认为是最终的权威。您只能通过在适当的位置使用一个备份 / 转储基础设施来预先做好准备。
* 最后，但不是最不重要的，缺陷、配置错误、物理环境、硬件失败、停电、不必要的系统重新引导等等，也都可能影响可用性。这个列表中的软件相关话题更应该归入 *系统安全*，稍后将更深入讨论。如上所述，硬件相关的话题在本文中不做讨论，但是，如果您对这些话题感兴趣，请参阅 [参考资料](http://www.ibm.com/developerworks/cn/linux/l-seclnx1.html#resources)部分以获得更多读物的链接。

解决上面列表中的前两个问题的特定 Linux 措施包括，网络数据包的防御（firewalling ） / 过滤（filtering ），对文件系统完整性的保护，以及计划可根据需要进行添加的额外的资源（例如，使用 Tivoli®Intelligent Orchestrator；参阅 [参考资料](http://www.ibm.com/developerworks/cn/linux/l-seclnx1.html#resources)以获得链接）。

## 系统安全

# 渗透测试

# 渗透测试分类

## 按信息获取方式分类

| 黑盒渗透（BlackBox ）  | 从目标网络的外部进行渗透模拟的，除了被测试目标的已知公开信息外，不提供任何其他信息。                                                                   |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 白盒渗透（White Box ） | 渗透测试者可以通过正常的渠道，向请求测试的机构获得目标网络系统的各种资料，包括网络拓扑结构、用户账户、操作系统、服务器类型、网络设备、代码片段等信息。 |
| 灰盒测试（Gray Box ）  | 介于二者之间。                                                                                                                                         |

## 按目标对象分类

| 主机操作系统渗透 | 对目标网络中的 Windows、Linux 、 Unix 等操作系统主机进行渗透测试         |
| ---------------- | ------------------------------------------------------------------------ |
| 数据库渗透测试   | 对 MS-SQL、Oracle 、 MySQL 等数据库系统进行渗透测试。                    |
| 网站程序渗透     | 渗透的目标网络系统都对外提供了 Web 网页、E-Mail 邮箱等网络程序应用服务。 |
| 网络设备渗透     | 对各种硬件防火墙、入侵检测系统、路由器和交换机等网络设备进行渗透测试。   |

## 按网络环境分类

| 外网 |     |
| ---- | --- |
| 内网 |     |

### 1. 分析目标网站内容及功能步骤

(1) 首先确定网站采用何种语言编写 . 或者是否有混用的情况 . 此处可以通过查看网站源文件 , 观察网站链接 , 捕获提交请求等方式获取 .

(2) 爬行网站目录 , 使用工具对网站目录进行爬行 , 可以辅助上一步让结果更加精准 . 将爬行结果存档 , 如果可以 , 此处应分析出网站是否使用通用程序 , 如果是 , 记录下来 . 进行下一步 .

(3) 根据上一步的爬行结果 , 对网站根目录或者关键目录进行暴力目录探测 , 如果网站为通用程序 , 判读是否有过二次开发 , 如非通用程序 , 在探测到的目录中寻找关键目录及文件 .

此步骤详细测试方法 :

①　输入并访问一些不可能存在的文件或目录名 , 再输入并访问一些通过目录爬行已知存在的目录及文件名 , 从而得知服务器如何处理无效资源 .

②　使用网站爬行到的结果作为此步骤暴力目录探测的依据 , 扫描关键目录或全部 .

③　确定服务器如何处理文件无法找到的回应 , 并使用关键字技术来处理这些回应 . 从而判断有效资源及无效资源 .

④　收集此步骤暴力扫描得到的结果 , 并手工检测探测到目录的有效性 .

⑤　重复以上步骤 , 得到更多更关键的目录及文件 .

(4) 通过上面步骤 , 得到一个完整的网站目录结构 , 以及枚举到的所有目录名称 , 文件名称及文件扩展名 . 了解网站开发人员的命名思路 , 确定其命名规则 , 推测出更多的目录及文件名 .

此步骤详细测试方法 :

² 检查整个列表中的文件命名规则 , 判读其命名依据 , 如发现几个部分内容相同的文件名 ,addnews.php,viewnews.php, 那么我们就可以尝试是否存在 editnews.php,delnews.php, 通常只要查看几个文件名 , 就可以推测出网站开发人员的命名习惯 , 根据其个人风格 , 开发者可能采用各种命名方法 , 如冗长式 (addnewuser.php), 简洁式 (adduser.php), 缩写式 (addusr.php), 或者更加模糊的命名方式 (addu.php). 了解开发者使用的命名习惯有助于推测出尚未确定内容的准确名称 .

² 有些不同内容的命名方案使用数字和日期作为标识符 , 通过他们可以轻易推测出隐藏的内容 . 静态页面经常采用这种命名方式 . 例如 PKAV.NET 的团队博客中 , 文章里所展示的图片的文件名没有被重新定义 , 采用了日期加数字递增的命名方案 , 如 2012 年 12 月 12 号发布的文章中的图片分别为 1.jpg,2.jpg,3.jpg. 那么这些图片的路径就是 /2012-12-12/1.jpg,/2012-12-12/2.jpg, /2012-12-12/3.jpg , 此时我们在博客上发布了一篇内容加密的文章 , 只有团队成员才知道密码 , 但是黑客们根据博客以往发布文章的命名规则推测出了这些图片的准确地址 , 从而通过图片内容泄漏了文章的大致概念 .

² 检查所有客户端代码 , 如 HTML 及 JS 代码 , 寻找任何隐藏了服务器端的线索 , 以及隐藏的表单元素等 . 认证检查注释内容 , 往往能带给我们惊喜 , 如部分通用程序会在网站首页放置一个通向网站管理后台的链接 , 但网站管理人员不希望这个链接被正常访问者所得知 , 于是将内容注释 , 我们可以通过查看 HTML 代码得知此具体地址 , 还有大多数的管理后台中所调用的 JS 中常常会存储着后台所有功能模块的链接地址 , 但在判断了当前用户权限后将其隐藏起来 , 我们也可以通过直接查看 JS 代码的方式得知具体的内容 , 还有一些开发者会在注释内容中记录一些敏感信息 , 我多次从注释信息中得到数据库的名称 , 甚至可以得到数据库的具体连接信息 ,SQL 查询语句等 .

² 把我们通过推测枚举出来的内容放在其他地方进行尝试。如文件 a.php 在 /111/ 这个目录下存在 , 那么我们可以尝试在 /222/ 这个目录下尝试是否存在相同文件 , 把所有枚举出来的文件名使用一些常规后缀来尝试访问 , 如 index.php 这个文件已知存在 , 我们可以使用 txt,bak,src,inc,tmp 等后缀进行尝试 , 如尝试 index.txt,index.bak 或者添加在原有后缀基础上 ,index.php.bak 等 . 这样可以帮助我们获取这些文件的未编译版本 , 开发版本或者备份文件 , 还可以通过网站使用的语言来推测 , 如 java 使用的 .cs 后缀等 .

² 搜索开发者使用的开发工具或者文本编辑器创建的临时文件。如 SVN 的 .svn/entries, 又或者 Ultraedit 这类文本编辑器的自动备份功能创建的 .bak 文件 , 被大量使用的 .tmp 后缀 , 以及 index.php~1 这样的遗留文件 , 这些都是可能会发现重要线索的细节 , 测试中一定不要遗漏这些步骤 .

² 将上述的步骤自动化 , 提取所有存在的文件名以及目录 , 后缀的词干信息 , 在所有目录下进行自动化批量探测 .

² 如果通过以上步骤已经确定一种统一的命名方案 , 那么就可以使用此命名规则在整个站点下进行测试 .

² 不断重复以上步骤 , 获取更多的关键信息 , 根据时间及个人想象力尽情发挥 !

(5) 利用公共信息 , 如搜索引擎 , 站点快照信息 , 以及其网站所使用的程序开发商公布的一些使用文档等信息近一步获取目标站点更多信息 .

a. 使用几种不同的搜索引擎和网站快照来获取目标站点的索引和历史内容记录 .

b. 使用高级搜索技巧如 :

site:www.hao123.com ( 返回此目标站点被搜索引擎抓取收录的所有内容 )

site:www.hao123.com 关键词 ( 返回此目标站点被搜索引擎抓取收录的包含此关键词的所有页面 . 此处我们可以将关键词设定为 , 网站后台 , 管理后台 , 密码修改 , 密码找回等 .) site:www.hao123.com inurl:admin.php ( 返回目标站点的地址中包含 admin.php 的所有页面 , 可以使用 admin.php,manage.php 或者其他关键词来寻找关键功能页面 )

link:www.hao123.com ( 返回所有包含目标站点链接的页面 , 其中包括其开发人员的个人博客 , 开发日志 , 或者开放这个站点的第三方公司 , 合作伙伴等 )

related:www.hao123.com ( 返回所有与目标站点 ” 相似 ” 的页面 , 可能会包含一些通用程序的信息等 .)

c. 在搜索时不要只使用网页的搜索功能 , 可以尝试如图片 , 新闻等功能来定位具体信息 .

d. 从搜索引擎的快照中寻找一些关键信息 , 如程序报错信息可以会泄漏网站具体路径 , 或者一些快照中会保存一些测试用的测试信息 , 比如说某个网站在开发了后台功能模块的时候 , 还没给所有页面增加权限鉴别 , 此时被搜索引擎抓取了快照 , 即使后来网站增加了权限鉴别 , 但搜索引擎的快照中仍会保留这些信息 .

e. 通过搜索引擎获取目标站点的子域名 , 得到更多的功能 , 如有些网站经常使用 admin 这个子域名作为其管理后台 , 如 admin.hao123.com 等 .

(6) 收集网站开发者信息 , 如网站的开发人员 , 管理维护人员等在互联网上的一些信息 .

①　列出网站中得到的所有开发及维护人员的姓名和邮件地址及其他联系方式 , 其中包含从网站联系功能中获取到的 , 从 HTML 或 JS 中的注释信息中得到的 , 已经内容页面上获取到的。

② 　使用上面介绍的一些高级搜索技巧 , 查找这些人在互联网上发布的与目标站点有关的一切信息 , 分析并发现有用的信息 , 如我曾经在用这个方法获取某国内大型网站的开发人员的信息时 , 竟发现他把他开发过的所有功能页面的源代码都放在一个公开的网站中 , 可以随意下载 , 包含了这个网站的数据库链接信息等关键内容 , 从而导致我轻松获取到这个大型网站的权限
