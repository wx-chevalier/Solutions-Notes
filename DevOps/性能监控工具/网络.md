# 网络

网络这个概念涵盖的范围较广，在应用层、传输层、网络层、网络接口层都有不同的指标去衡量。这里我们讨论的「网络」，特指应用层的网络，通常使用的指标如下:

- 网络带宽：表示链路的最大传输速率；
- 网络吞吐：表示单位时间内成功传输的数据量大小；
- 网络延时：表示从网络请求发出后直到收到远端响应，所需要的时间；
- 网络连接数和错误数；

一般来说，应用层的网络瓶颈有如下几类：

- 集群或机器所在的机房的网络带宽饱和，影响应用 QPS/TPS 的提升；
- 网络吞吐出现异常，如接口存在大量的数据传输，造成带宽占用过高；
- 网络连接出现异常或错误；
- 网络出现分区。

带宽和网络吞吐这两个指标，一般我们会关注整个应用的，通过监控系统可直接得到，如果一段时间内出现了明显的指标上升，说明存在网络性能瓶颈。对于单机，可以使用 sar 得到网络接口、进程的网络吞吐。

使用 ping 或者 hping3 可以得到是否出现网络分区、网络具体时延。对于应用，我们更关注整个链路的时延，可以通过中间件埋点后输出的 trace 日志得到链路上各个环节的时延信息。使用 netstat、ss 和 sar 可以获取网络连接数或网络错误数。

```sh
# 查看系统当前网络连接数
$ netstat -n | awk '/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}'
```
